<!DOCTYPE html>

<html lang="en" dir="ltr">
<head>
    <meta charset="utf-8">
  <title>Airbnb Animation</title>
  <script src="https://d3js.org/d3.v4.js"></script>
</head>

<body>
<!-- Animation: Add 3 buttons -->
<button onclick="update('averageReviewScoresLocation')">Location Review Score</button>
<button onclick="update('averageReviewsPerMonth')">Reviews Per Month</button>
<button onclick="update('averageNumberReviews')">General Average Number of Reviews</button>

<!-- Create a div -->
<div id="my_dataviz"></div>


</body>

<script>

    // set the dimensions and margins
    var margin = {top: 30, right: 30, bottom: 70, left: 60},
        width = 1460 - margin.left - margin.right,
        height = 400 - margin.top - margin.bottom;
    
    // append the svg object to body
    var svg = d3.select("#my_dataviz")
      .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
      .append("g")
        .attr("transform",
              "translate(" + margin.left + "," + margin.top + ")");
    
    // X axis
    var x = d3.scaleBand()
      .range([ 0, width ])
      .padding(1);
    var xAxis = svg.append("g")
      .attr("transform", "translate(0," + height + ")")
    
    // Y axis
    var y = d3.scaleLinear()
      .range([ height, 0]);
    var yAxis = svg.append("g")
      .attr("class", "myYaxis")
    
    
    // A function updating the plot
    function update(selectedVar) {
    
      // Parse the Data
      d3.csv("listings3.csv", function(data) {
    //     // sort data
    // data.sort(function(b, a) {
    //   return a.neighbourhoodGroup - b.neighbourhoodGroup;
    // });
    
        // update X axis
        x.domain(data.map(function(d) { return d.neighbourhoodGroup; }))
        xAxis.transition().duration(1000).call(d3.axisBottom(x))
    
        // update Y axis
        y.domain([0, d3.max(data, function(d) { return +d[selectedVar] }) ]);
        yAxis.transition().duration(1000).call(d3.axisLeft(y));
    
        // variable line: map data and add line to existing plot
        var line = svg.selectAll(".myLine")
          .data(data)
        // update lines
        line
          .enter()
          .append("line")
          .attr("class", "myLine")
          .merge(line)
          .transition()
          .duration(1000)
            .attr("x1", function(d) { console.log(x(d.neighbourhoodGroup)) ; return x(d.neighbourhoodGroup); })
            .attr("x2", function(d) { return x(d.neighbourhoodGroup); })
            .attr("x3", function(d) { return x(d.neighbourhoodGroup); })
            .attr("y1", y(0))
            .attr("y2", function(d) { return y(d[selectedVar]); })
            .attr("stroke", "grey")
            .attr("y3", function(d) { return y(d[selectedVar]); })
            .attr("stroke", "grey")
    
    
        // variable circle: map data and add circle to existing plot
        var circle = svg.selectAll("circle")
          .data(data)
        circle
          .enter()
          .append("circle")
          .merge(circle)
          .transition()
          .duration(1000)
            .attr("cx", function(d) { return x(d.neighbourhoodGroup); })
            .attr("cy", function(d) { return y(d[selectedVar]); })
            .attr("r", 6)
            .attr("fill", "#69b3a2");
    
    
      })
    
    }
    
    // Initialize/update plot
    update('averageReviewScoresLocation')
    
    </script>

</html>